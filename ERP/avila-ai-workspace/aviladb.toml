# AvilaDB Configuration File
# Todas as configurações são opcionais. Defaults são usados se omitidos.

[server]
# Endereço e porta para bind do servidor
# Default: "127.0.0.1:7000"
bind_addr = "127.0.0.1:7000"

# Diretório para armazenar dados persistentes
# Default: "./aviladb-data"
data_dir = "./aviladb-data"

# Máximo de threads de trabalho
# Default: número de CPUs disponíveis
# worker_threads = 8

# Modo de operação
# Valores: "standalone" | "cluster"
# Default: "standalone"
mode = "standalone"


[performance]
# Tamanho do cache em memória (MB)
# Usado para armazenar dados frequentemente acessados
# Default: 256
cache_size_mb = 256

# Intervalo para checkpoint/flush em disco (segundos)
# Default: 60
checkpoint_interval_sec = 60

# Número de threads para compactação de LSM Tree
# Default: 2
compaction_threads = 2

# Tamanho do MemTable antes de flush (MB)
# Default: 64
memtable_size_mb = 64

# Número máximo de níveis no LSM Tree
# Default: 7
lsm_max_levels = 7

# Fator de crescimento entre níveis
# Default: 10 (cada nível é 10x maior que o anterior)
level_size_multiplier = 10


[crypto]
# Chave pública do servidor (hex)
# Gerada automaticamente se não fornecida
# Exemplo: "02a1b2c3d4e5f6789..."
# public_key = ""

# Chave privada do servidor (hex)
# ⚠️  NUNCA commite isso em controle de versão!
# ⚠️  Use variáveis de ambiente em produção: AVILADB_PRIVATE_KEY
# private_key = ""

# Algoritmo de assinatura
# Valores: "schnorr" | "ecdsa"
# Default: "schnorr" (mais eficiente)
signature_scheme = "schnorr"

# Força verificação de assinatura em todas as transações
# Default: true
enforce_signatures = true


[network]
# Máximo de conexões simultâneas
# Default: 1000
max_connections = 1000

# Timeout de idle para conexões (segundos)
# Conexões inativas são fechadas após esse período
# Default: 30
idle_timeout_sec = 30

# Tamanho máximo de payload UDP (bytes)
# QUIC usa UDP, então deve ser <= MTU da rede
# Default: 1200 (seguro para maioria das redes)
max_udp_payload = 1200

# Número de streams QUIC concorrentes por conexão
# Default: 100
max_concurrent_streams = 100

# Tamanho inicial da janela de congestionamento (bytes)
# Default: 14720 (10 * max_udp_payload)
initial_congestion_window = 14720

# Ativa 0-RTT reconnection
# Melhora latência mas tem riscos de replay attack
# Default: true
enable_zero_rtt = true

# Keep-alive ping interval (segundos)
# 0 = desabilitado
# Default: 10
keep_alive_interval = 10


[transaction]
# Nível de isolamento padrão
# Valores: "read_uncommitted" | "read_committed" | "repeatable_read" | "serializable"
# Default: "repeatable_read" (via MVCC)
default_isolation = "repeatable_read"

# Timeout máximo para transação (segundos)
# Transações que excedem esse tempo são abortadas
# Default: 60
max_transaction_duration_sec = 60

# Número máximo de versões a manter (MVCC)
# Default: 100
max_versions_per_key = 100

# Intervalo de garbage collection de versões antigas (segundos)
# Default: 300 (5 minutos)
gc_interval_sec = 300


[storage]
# Engine de storage
# Valores: "lsm_tree" (único suportado por enquanto)
# Default: "lsm_tree"
engine = "lsm_tree"

# Compressão de dados em disco
# Valores: "none" | "lz4" | "zstd"
# Default: "none" (compressão vem em v0.2)
compression = "none"

# Sync fsync após cada write
# true = durabilidade máxima mas mais lento
# false = mais rápido mas risco de perda em crash
# Default: true
fsync_on_write = true

# Usa direct I/O (bypass page cache do SO)
# Reduz latência mas requer hardware adequado
# Default: false
use_direct_io = false


[logging]
# Nível de log
# Valores: "trace" | "debug" | "info" | "warn" | "error"
# Default: "info"
level = "info"

# Formato de log
# Valores: "json" | "text"
# Default: "text"
format = "text"

# Arquivo para escrever logs
# Default: stdout
# log_file = "./aviladb.log"

# Rotação de logs
# Default: false
# rotate_logs = true
# max_log_size_mb = 100
# max_log_files = 10


[monitoring]
# Porta para métricas (Prometheus-compatible)
# 0 = desabilitado
# Default: 0 (desabilitado)
metrics_port = 9090

# Intervalo de coleta de métricas (segundos)
# Default: 10
metrics_interval_sec = 10

# Ativa profiling contínuo
# ⚠️  Impacto em performance, apenas para desenvolvimento
# Default: false
enable_profiling = false


[cluster]
# Configurações de cluster (futuro)
# Por enquanto apenas modo standalone é suportado

# Node ID único no cluster
# node_id = "node-1"

# Lista de peers
# peers = [
#     "127.0.0.1:7001",
#     "127.0.0.1:7002",
# ]

# Fator de replicação
# replication_factor = 3

# Algoritmo de consenso
# Valores: "raft"
# consensus = "raft"


[experimental]
# Features experimentais - use com cuidado!

# Ativa GLV endomorphism para secp256k1 (2x mais rápido)
# Default: false (ainda não implementado)
use_glv_endomorphism = false

# Ativa Shamir Secret Sharing para chaves
# Default: false (futuro)
use_threshold_signatures = false

# Usa AVX-512 se disponível
# Default: true
use_avx512 = true

# Usa huge pages (requer configuração do SO)
# Default: false
use_huge_pages = false


# ========================================
# Exemplos de Configuração por Ambiente
# ========================================

# --- Development ---
# [server]
# bind_addr = "127.0.0.1:7000"
# data_dir = "./dev-data"
#
# [logging]
# level = "debug"
#
# [monitoring]
# metrics_port = 9090
# enable_profiling = true


# --- Production ---
# [server]
# bind_addr = "0.0.0.0:7000"
# data_dir = "/var/lib/aviladb"
# worker_threads = 16
#
# [performance]
# cache_size_mb = 2048
# compaction_threads = 4
#
# [network]
# max_connections = 10000
#
# [storage]
# fsync_on_write = true
# use_direct_io = true
#
# [logging]
# level = "warn"
# format = "json"
# log_file = "/var/log/aviladb/aviladb.log"
# rotate_logs = true


# --- High Performance ---
# [server]
# worker_threads = 32
#
# [performance]
# cache_size_mb = 8192
# memtable_size_mb = 256
# checkpoint_interval_sec = 300
#
# [network]
# max_udp_payload = 1500
# enable_zero_rtt = true
#
# [storage]
# fsync_on_write = false  # ⚠️  Risco de perda de dados!
# use_direct_io = true
#
# [experimental]
# use_avx512 = true
# use_huge_pages = true
