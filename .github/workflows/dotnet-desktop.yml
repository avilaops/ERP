name: .NET MAUI Build & Deploy

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build-android:
    name: Build Android
    runs-on: windows-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup .NET 9
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'

    - name: Install .NET MAUI workload
      run: dotnet workload install maui

    - name: Restore dependencies
      run: dotnet restore Controle-Roncatin.csproj

    - name: Build Android (Debug)
      if: github.event_name == 'pull_request'
 run: |
dotnet build Controle-Roncatin.csproj `
 -f net9.0-android `
      -c Debug

    - name: Build Android AAB (Release)
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      run: |
  dotnet publish Controle-Roncatin.csproj `
   -f net9.0-android `
          -c Release `
          -p:AndroidPackageFormat=aab
      # Nota: Para assinar o AAB, adicione as secrets:
      # ANDROID_KEYSTORE_BASE64, KEYSTORE_PASSWORD, KEY_ALIAS, KEY_PASSWORD
      # e descomente as linhas de assinatura no .csproj

    - name: Upload Android Artifact
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      uses: actions/upload-artifact@v4
      with:
        name: android-aab
        path: |
          **/*.aab
          **/*.apk
        retention-days: 30

  build-windows:
    name: Build Windows
    runs-on: windows-latest
    
    steps:
    - name: Checkout
   uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup .NET 9
   uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'

    - name: Install .NET MAUI workload
      run: dotnet workload install maui

- name: Restore dependencies
   run: dotnet restore Controle-Roncatin.csproj

    - name: Build Windows (Debug)
      if: github.event_name == 'pull_request'
      run: |
        dotnet build Controle-Roncatin.csproj `
          -f net9.0-windows10.0.19041.0 `
          -c Debug

  - name: Publish Windows (Release)
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      run: |
        dotnet publish Controle-Roncatin.csproj `
          -f net9.0-windows10.0.19041.0 `
          -c Release `
 -p:RuntimeIdentifierOverride=win10-x64 `
          -o ./publish/windows

    - name: Upload Windows Artifact
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      uses: actions/upload-artifact@v4
      with:
      name: windows-exe
        path: ./publish/windows/**/*
   retention-days: 30

  build-ios:
    name: Build iOS
    runs-on: macos-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup .NET 9
      uses: actions/setup-dotnet@v4
      with:
      dotnet-version: '9.0.x'

    - name: Install .NET MAUI workload
      run: dotnet workload install maui

    - name: Restore dependencies
      run: dotnet restore Controle-Roncatin.csproj

  - name: Build iOS (Debug)
      if: github.event_name == 'pull_request'
      run: |
     dotnet build Controle-Roncatin.csproj \
          -f net9.0-ios \
          -c Debug

    - name: Build iOS (Release)
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
   run: |
        dotnet build Controle-Roncatin.csproj \
          -f net9.0-ios \
     -c Release
      # Nota: Para assinar e publicar no App Store, você precisa:
      # - Certificado de distribuição iOS
      # - Provisioning Profile
      # - Adicionar secrets no GitHub

    - name: Upload iOS Artifact
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      uses: actions/upload-artifact@v4
      with:
   name: ios-app
        path: |
          **/*.ipa
  **/*.app
        retention-days: 30

  build-macos:
    name: Build macOS
  runs-on: macos-latest
    
    steps:
    - name: Checkout
   uses: actions/checkout@v4
      with:
  fetch-depth: 0

    - name: Setup .NET 9
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'

    - name: Install .NET MAUI workload
   run: dotnet workload install maui

    - name: Restore dependencies
    run: dotnet restore Controle-Roncatin.csproj

    - name: Build macOS (Debug)
      if: github.event_name == 'pull_request'
      run: |
        dotnet build Controle-Roncatin.csproj \
       -f net9.0-maccatalyst \
      -c Debug

    - name: Build macOS (Release)
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      run: |
        dotnet build Controle-Roncatin.csproj \
          -f net9.0-maccatalyst \
   -c Release

    - name: Upload macOS Artifact
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
      uses: actions/upload-artifact@v4
      with:
        name: macos-app
        path: |
        **/*.pkg
    **/*.app
        retention-days: 30
